CREATE TABLE IF NOT EXISTS players (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  first_name TEXT NOT NULL,
  last_name TEXT NOT NULL,
  email TEXT,
  phone TEXT,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS matches (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  played_at TIMESTAMP NOT NULL,
  location TEXT NOT NULL,
  team1_player1_id INTEGER NOT NULL REFERENCES players(id) ON DELETE RESTRICT,
  team1_player2_id INTEGER NOT NULL REFERENCES players(id) ON DELETE RESTRICT,
  team2_player1_id INTEGER NOT NULL REFERENCES players(id) ON DELETE RESTRICT,
  team2_player2_id INTEGER NOT NULL REFERENCES players(id) ON DELETE RESTRICT,
  rounds_played INTEGER NOT NULL DEFAULT 0,
  status TEXT NOT NULL DEFAULT 'scheduled',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS match_rounds (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  match_id INTEGER NOT NULL REFERENCES matches(id) ON DELETE CASCADE,
  round_index INTEGER NOT NULL,
  team1_score INTEGER NOT NULL DEFAULT 0,
  team2_score INTEGER NOT NULL DEFAULT 0
);

CREATE INDEX IF NOT EXISTS idx_matches_played_at ON matches(played_at DESC);
CREATE INDEX IF NOT EXISTS idx_match_rounds_match_id ON match_rounds(match_id);
